!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VsItineraryMap=e():t.VsItineraryMap=e()}(window,function(){return(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[161],{"+UO6":function(t,e,o){"use strict";var i=o("w25V");o.d(e,"a",function(){return i.a}),o.d(e,"b",function(){return i.b})},"3foS":function(t,e,o){},"5DBm":function(t,e,o){"use strict";var i=o("3foS");o.n(i).a},RF9V:function(t,e,o){"use strict";o.r(e);var i=o("+UO6"),n=o("SNLw"),a=(o("5DBm"),o("KHd+")),r=o("eBe/"),s=o.n(r),p=Object(a.a)(n.a,i.a,i.b,!1,null,null,null);"function"==typeof s.a&&s()(p),p.options.__file="src/components/patterns/itineraries/components/itinerary-map/ItineraryMap.vue",e.default=p.exports},SNLw:function(t,e,o){"use strict";var i=o("hC5G");e.a=i.a},"eBe/":function(t,e){},hC5G:function(t,e,o){"use strict";o("pNMO"),o("ma9I"),o("TeQF"),o("QWBl"),o("2B1R"),o("5DmW"),o("27RR"),o("tkto"),o("FZtP");var i=o("lSNA"),n=o.n(i),a=o("kb3O"),r=o("H0eK"),s=o("3f3L");function p(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,i)}return o}var u=null,l=null;e.a={name:"VsItineraryMap",status:"prototype",release:"0.0.1",props:{accessToken:{type:String,required:!0},labels:{type:Object,required:!0},overviewMapLatitude:{type:String,required:!0,default:"-4.13"},overviewMapLongitude:{type:String,required:!0,default:"57.81"},overviewMapZoom:{type:String,required:!1,default:"5"},stops:{type:Array,required:!0}},data:function(){return{isDesktop:!1,geojsonData:{type:"FeatureCollection",features:[]},mapbox:{map:null,bounds:null,rotation:0,config:{container:this.$refs.mapbox,style:"https://api.maptiler.com/maps/37d4e215-6535-46b5-a5f7-fd09bd5897bb/style.json?key=".concat(this.accessToken),center:[parseFloat(this.overviewMapLatitude),parseFloat(this.overviewMapLongitude)],zoom:parseInt(this.overviewMapZoom,10),maxBounds:[[-11.697414,52.801395],[.651219,61.395636]],pitchWithRotate:!1,dragRotate:!1}},markers:[],popup:null}},itinerariesStore:a.default,computed:{mapPadding:function(){return this.isTablet?{top:100,bottom:100,left:100,right:100}:{top:50,bottom:50,left:50,right:50}},highlightedStop:function(){return a.default.getters["itineraries/getHighlightedStop"]},highlightedStopCoordinates:function(){return a.default.getters["itineraries/getHighlightedStopCoordinates"]}},watch:{highlightedStopCoordinates:function(){this.addMapPopup()}},mounted:function(){this.lazyloadMapComponent(),this.isTablet=window.innerWidth>=768,window.addEventListener("resize",this.onResize)},destroyed:function(){window.removeEventListener("resize",this.onResize)},methods:{addMap:function(){var t=this;this.mapbox.config.container=this.$refs.mapbox,this.mapbox.map=new u.Map(this.mapbox.config),this.mapbox.map.scrollZoom.disable(),this.mapbox.map.on("rotate",function(){t.mapbox.rotation=t.mapbox.map.transform.angle})},addMapControls:function(){var t=new u.NavigationControl;this.mapbox.map.addControl(t,"top-right"),this.mapbox.map.addControl(new u.FullscreenControl)},addMapFeatures:function(){var t=this;this.stops.map(function(e){return t.geojsonData.features.push({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(e.longitude),parseFloat(e.latitude)]},properties:{title:e.title,stopCount:e.stopCount,imageSrc:e.imageSrc,altText:e.altText}})})},addMapMarkers:function(){var t=this;this.geojsonData.features.forEach(function(e){var o=new s.default(function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?p(Object(o),!0).forEach(function(e){n()(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}({},r.default,{parent:t,propsData:{feature:e}}));o.$mount();var i=new u.Marker(o.$el).setLngLat(e.geometry.coordinates).addTo(t.mapbox.map);t.markers.push(i)})},addMapPopup:function(){this.removeMapPopup(),null!==this.highlightedStopCoordinates&&null!==this.highlightedStop&&(this.popup=new u.Popup({closeButton:!1,offset:{top:[0,20],"top-left":[0,20],"top-right":[0,20],bottom:[0,-50],"bottom-left":[0,-50],"bottom-right":[0,-50],left:[30,-20],right:[-30,-20]}}).setLngLat(this.highlightedStopCoordinates).setHTML('\n                            <img class="vs-itinerary__map-popup-image" src="'.concat(this.highlightedStop.properties.imageSrc,'" alt="').concat(this.highlightedStop.properties.altText,'" />\n                            <div>\n                            <h4 class="vs-itinerary__map-popup-stop-number mb-0">').concat(this.labels.stopLabel," ").concat(this.highlightedStop.properties.stopCount,'</h4>\n                            <p class="vs-itinerary__map-popup-stop-name">').concat(this.highlightedStop.properties.title,"</p>\n                            </div>\n                        ")).addTo(this.mapbox.map))},fitToBounds:function(){this.mapbox.map.fitBounds(l(this.geojsonData),{padding:this.mapPadding})},initialiseMapComponent:function(){this.addMap(),this.addMapControls(),this.stops.length&&this.addMapFeatures(),this.geojsonData.features.length&&(this.addMapMarkers(),this.fitToBounds())},lazyloadMapComponent:function(){var t=this;u=o("4ZJM"),l=o("KVSD"),u.supported({failIfMajorPerformanceCaveat:!0}),"IntersectionObserver"in window?(this.observer=new IntersectionObserver(function(e){e[0].intersectionRatio>0&&(t.observer.unobserve(t.$el),t.initialiseMapComponent())}),this.observer.observe(this.$el)):this.initialiseMapComponent()},removeMapPopup:function(){null!==this.popup?(this.popup.remove(),this.popup=null):this.popup=null}},onResize:function(){this.isTablet=window.innerWidth>=768}}},w25V:function(t,e,o){"use strict";o.d(e,"a",function(){return i}),o.d(e,"b",function(){return n});var i=function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"mapbox",staticClass:"vs-itinerary__map"})},n=[];i._withStripped=!0}},[["RF9V",0,1,2,4,3,5,6,7,8,9,11,14,16,22,23,40,211,20,24,25,64,87]]])});