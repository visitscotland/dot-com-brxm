!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Vue")):"function"==typeof define&&define.amd?define(["Vue"],e):"object"==typeof exports?exports.ItineraryMap=e(require("Vue")):t.ItineraryMap=e(t.Vue)}(window,function(t){return(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[176,116,117,118,121,122,123,125,126,137,138,140,141,142,156,158,166,172,177,178,181,195,196,197,199,201,205,220,221,222,223,224],{QZry:function(t,e,o){"use strict";var i=o("e3f2");o.n(i).a},RF9V:function(t,e,o){"use strict";o.r(e);var i=o("pLUp"),n=o("SNLw"),r=(o("QZry"),o("KHd+")),a=o("eBe/"),s=o.n(a),p=Object(r.a)(n.a,i.a,i.b,!1,null,"20a0be1d",null);"function"==typeof s.a&&s()(p),p.options.__file="src/components/patterns/itineraries/components/itinerary-map/ItineraryMap.vue",e.default=p.exports},SNLw:function(t,e,o){"use strict";var i=o("hC5G");e.a=i.a},SSZh:function(t,e,o){"use strict";o.d(e,"a",function(){return i}),o.d(e,"b",function(){return n});var i=function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"mapbox",staticClass:"vs-itinerary__map"})},n=[];i._withStripped=!0},e3f2:function(t,e,o){},"eBe/":function(t,e){},hC5G:function(t,e,o){"use strict";o("pNMO"),o("ma9I"),o("TeQF"),o("QWBl"),o("2B1R"),o("5DmW"),o("27RR"),o("tkto"),o("FZtP");var i=o("lSNA"),n=o.n(i),r=o("kb3O"),a=o("H0eK"),s=o("i7/w"),p=o.n(s),u=o("4ZJM"),c=o.n(u),d=o("KVSD"),h=o.n(d);function l(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,i)}return o}o("rG3h"),e.a={name:"VsItineraryMap",status:"prototype",release:"0.0.1",props:{accessToken:{type:String,required:!0},labels:{type:Object,required:!0},overviewMapLatitude:{type:String,required:!0,default:"-4.13"},overviewMapLongitude:{type:String,required:!0,default:"57.81"},overviewMapZoom:{type:String,required:!1,default:"5"},stops:{type:Array,required:!0}},data:function(){return{isDesktop:!1,geojsonData:{type:"FeatureCollection",features:[]},mapbox:{map:null,bounds:null,rotation:0,config:{container:this.$refs.mapbox,style:"https://api.maptiler.com/maps/37d4e215-6535-46b5-a5f7-fd09bd5897bb/style.json?key=".concat(this.accessToken),center:[parseFloat(this.overviewMapLatitude),parseFloat(this.overviewMapLongitude)],zoom:parseInt(this.overviewMapZoom,10),maxBounds:[[-11.697414,52.801395],[.651219,61.395636]],pitchWithRotate:!1,dragRotate:!1}},markers:[],popup:null}},itinerariesStore:r.default,computed:{mapPadding:function(){return this.isTablet?{top:100,bottom:100,left:100,right:100}:{top:50,bottom:50,left:50,right:50}},highlightedStop:function(){return r.default.getters["itineraries/getHighlightedStop"]},highlightedStopCoordinates:function(){return r.default.getters["itineraries/getHighlightedStopCoordinates"]}},watch:{highlightedStopCoordinates:function(){this.addMapPopup()}},created:function(){this.bodyStyleAttribute=null!==document.body.getAttribute("style")?document.body.getAttribute("style"):"",c.a.supported({failIfMajorPerformanceCaveat:!0})},mounted:function(){this.lazyloadMapComponent(),this.isTablet=window.innerWidth>=768,window.addEventListener("resize",this.onResize)},destroyed:function(){window.removeEventListener("resize",this.onResize)},methods:{addMap:function(){var t=this;this.mapbox.config.container=this.$refs.mapbox,this.mapbox.map=new c.a.Map(this.mapbox.config),this.mapbox.map.scrollZoom.disable(),this.mapbox.map.on("rotate",function(){t.mapbox.rotation=t.mapbox.map.transform.angle})},addMapControls:function(){var t=new c.a.NavigationControl;this.mapbox.map.addControl(t,"top-right"),this.mapbox.map.addControl(new c.a.FullscreenControl)},addMapFeatures:function(){var t=this;this.stops.map(function(e){return t.geojsonData.features.push({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(e.longitude),parseFloat(e.latitude)]},properties:{title:e.title,stopCount:e.stopCount,imageSrc:e.imageSrc,altText:e.altText}})})},addMapMarkers:function(){var t=this;this.geojsonData.features.forEach(function(e){var o=new p.a(function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?l(Object(o),!0).forEach(function(e){n()(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}({},a.default,{parent:t,propsData:{feature:e}}));o.$mount();var i=new c.a.Marker(o.$el).setLngLat(e.geometry.coordinates).addTo(t.mapbox.map);t.markers.push(i)})},addMapPopup:function(){this.removeMapPopup(),null!==this.highlightedStopCoordinates&&null!==this.highlightedStop&&(this.popup=new c.a.Popup({closeButton:!1,offset:{top:[0,20],"top-left":[0,20],"top-right":[0,20],bottom:[0,-50],"bottom-left":[0,-50],"bottom-right":[0,-50],left:[30,-20],right:[-30,-20]}}).setLngLat(this.highlightedStopCoordinates).setHTML('\n                            <img class="vs-itinerary__map-popup-image" src="'.concat(this.highlightedStop.properties.imageSrc,'" alt="').concat(this.highlightedStop.properties.altText,'" />\n                            <div>\n                            <h4 class="vs-itinerary__map-popup-stop-number mb-0">').concat(this.labels.stopLabel," ").concat(this.highlightedStop.properties.stopCount,'</h4>\n                            <p class="vs-itinerary__map-popup-stop-name">').concat(this.highlightedStop.properties.title,"</p>\n                            </div>\n                        ")).addTo(this.mapbox.map))},fitToBounds:function(){this.mapbox.map.fitBounds(h()(this.geojsonData),{padding:this.mapPadding})},initialiseMapComponent:function(){this.addMap(),this.addMapControls(),this.stops.length&&this.addMapFeatures(),this.geojsonData.features.length&&(this.addMapMarkers(),this.fitToBounds())},lazyloadMapComponent:function(){var t=this;"IntersectionObserver"in window?(this.observer=new IntersectionObserver(function(e){e[0].intersectionRatio>0&&(t.observer.unobserve(t.$el),t.initialiseMapComponent())}),this.observer.observe(this.$el)):this.initialiseMapComponent()},removeMapPopup:function(){null!==this.popup?(this.popup.remove(),this.popup=null):this.popup=null}},onResize:function(){this.isTablet=window.innerWidth>=768}}},"i7/w":function(e,o){e.exports=t},pLUp:function(t,e,o){"use strict";var i=o("SSZh");o.d(e,"a",function(){return i.a}),o.d(e,"b",function(){return i.b})}},[["RF9V",0,1,2,3,5,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,27,28,35,37,39,38,41,53,60,228,36,42,80,103]]])});